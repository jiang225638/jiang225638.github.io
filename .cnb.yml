master:
  push:
    - runner:
        cpus: 16
      services:
        - docker
        - git-clone-yyds
      docker:
        image: docker.cnb.cool/znb/images/node:18
        volumes:
          - /data/.cache:copy-on-write #å£°æ˜å¼çš„æ„å»ºç¼“å­˜
      stages:
        - name: ğŸ–¨ï¸ æ‰“å°ç¯å¢ƒ
          if: |
            [ "$CNB_COMMIT_MESSAGE_TITLE" = "BUILD" ]
          script: |
            node -v && npm -v && yarn -v && pnpm -v
        - name: ğŸ“¦ï¸ å®‰è£…ä¾èµ– 
          if: |
            [ "$CNB_COMMIT_MESSAGE_TITLE" = "BUILD" ]          
          script: |
            pnpm install
            
        - name: âš—ï¸ ç¼–è¯‘é¡¹ç›®
          if: |
            [ "$CNB_COMMIT_MESSAGE_TITLE" = "BUILD" ]        
          script: |
            pnpm docs:build   # VitePress ä¸“ç”¨å‘½ä»¤
        - name: ğŸšš å‘å¸ƒåˆ¶å“
          if: |
            [ "$CNB_COMMIT_MESSAGE_TITLE" = "BUILD" ]            
          image: tencentcom/rsync
          imports: https://cnb.cool/onedayxyy/vitepress-theme-teek-one-private/-/blob/master/env.yaml
          settings:
            user: ${SSH_USER}
            key: ${SSH_KEY}
            port: 22
            hosts:
              - ${ECS_IP}
            source: docs/.vitepress/dist/
            target: /root/rsync/rsync-vitepress/dist/
            delete: true
            prescript:
              - echo "prescript"
              - ls -l  /root/rsync/rsync-vitepress/dist/
            # script:
            #   - echo "after script"
            #   - ls -l /root/rsync/rsync-vitepress/dist/
            #   - date
            #   # - bash  /root/website_music.sh
            #   - aliyun cdn RefreshObjectCaches --ObjectType File --ObjectPath "onedayxyy.cn/" #åˆ·æ–°é˜¿é‡Œäº‘cdnç¼“å­˜

        # - name: ğŸ”” å‘å¸ƒé€šçŸ¥
        #   image: tencentcom/wecom-message
        #   settings:
        #     robot: ${WECOM_BOT}
        #     msgType: markdown
        #     content: |
        #       > **ğŸ‰ JenkinsGuide åˆä¸€æ¬¡å‘å¸ƒå•¦ï¼**
        #       > **æ„å»ºæ—¶é—´:** $CUSTOM_ENV_DATE_INFO
        #       > **æäº¤ä¿¡æ¯:** $CNB_COMMIT_MESSAGE_TITLE
        #       > **ä»“åº“åœ°å€:** [$CNB_REPO_URL_HTTPS]($CNB_REPO_URL_HTTPS)

        #åŒæ­¥ä»“åº“åˆ°gitee                  
        - name: sync to gitee
          image: tencentcom/git-sync
          imports: https://cnb.cool/onedayxyy/vitepress-theme-teek-one-private/-/blob/master/env.yaml
          settings:
            branch: master
            auth_type: https
            username: ${GIT_USERNAME}
            password: ${GIT_ACCESS_TOKEN}
            target_url: https://gitee.com/onlyonexl/vitepress-theme-teek-one-private.git
            # git_email: 'github-actions[bot]@users.noreply.github.com'